{% extends "layouts/base.html" %}

{% block title %} UI Tables {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
    <style>
        .form-control {
            margin-bottom: 10px;
        }
        .kuriniai-row {
            background: #f8f9fa;
            display: none; /* Hide Kūriniai initially */
        }
        .kuriniai-number {
            text-align: center;
            font-weight: bold;
        }
        .kuriniai-selection {
            background: #f3f3f3;
            padding: 15px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .kuriniai-selection label {
            display: block;
            font-size: 18px;
            margin-bottom: 5px;
        }
        .checkbox-large {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
    </style>
{% endblock stylesheets %}

{% block content %}

<div class="row">
    <!-- Programos Table -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header card-header-info">
                <h4 class="card-title">Programų sąrašas</h4>
            </div>
            <div class="card-body">
                <table class="table" id="programos-table">
                    <thead>
                    <tr>
                        <th class="text-center">ID</th>
                        <th>Pavadinimas</th>
                        <th>Tipas</th>
                        <th class="text-right">Actions</th>
                    </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Example Program -->
                        <tr>
                            <td class="text-center">1</td>
                            <td>Kalėdinė vakaronė</td>
                            <td>Kaledoms</td>
                            <td class="td-actions text-right">
                                <button type="button" class="btn btn-info" onclick="toggleKuriniai(1)">
                                    <i class="material-icons">expand_more</i>
                                </button>
                                <button type="button" class="btn btn-success">
                                    <i class="material-icons">edit</i>
                                </button>
                                <button type="button" class="btn btn-danger" onclick="deleteProgram(this, 1)">
                                    <i class="material-icons">close</i>
                                </button>
                            </td>
                        </tr>
                        <!-- Kūriniai Rows (Initially Hidden) -->
                        <tr class="kuriniai-row kuriniai-1">
                            <td class="kuriniai-number">1.</td>
                            <td>Dzūkų daina</td>
                            <td>Daina</td>
                            <td></td>
                        </tr>
                        <tr class="kuriniai-row kuriniai-1">
                            <td class="kuriniai-number">2.</td>
                            <td>Suvalkų šokis</td>
                            <td>Šokis</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Form to Add a New Programa -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header card-header-danger">
                <h4 class="card-title">Pridėti naują programą</h4>
                <p class="category">Įveskite informaciją apie programą</p>
            </div>
            <div class="card-body">
                <form id="add-form">
                    <div class="form-group">
                        <label>Pavadinimas</label>
                        <input type="text" id="pavadinimas" class="form-control" required placeholder="Programos pavadinimas">
                    </div>

                    <div class="form-group">
                        <label>Tipas</label>
                        <select id="tipas" class="form-control" required>
                            <option value="Adventui">Adventui</option>
                            <option value="Rasoms">Rasoms</option>
                            <option value="Lygiadieniui">Lygiadieniui</option>
                            <option value="Vakaronei">Vakaronei</option>
                            <option value="Kaledoms">Kaledoms</option>
                            <option value="Velykoms">Velykoms</option>
                            <option value="Susidainavimams">Susidainavimams</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label><strong>Pridėti kūrinius:</strong></label>
                        <div class="kuriniai-selection">
                            <label><input type="checkbox" class="checkbox-large" value="Dzūkų daina|Daina"> Dzūkų daina</label>
                            <label><input type="checkbox" class="checkbox-large" value="Suvalkų šokis|Šokis"> Suvalkų šokis</label>
                            <label><input type="checkbox" class="checkbox-large" value="Kapelos melodija|Kapela"> Kapelos melodija</label>
                        </div>
                    </div>

                    <button type="button" class="btn btn-danger btn-lg" onclick="addPrograma()">Pridėti programą</button>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
    <script>
        function toggleKuriniai(programId) {
            let kuriniaiRows = document.querySelectorAll(`.kuriniai-${programId}`);
            let btn = document.querySelector(`button[onclick="toggleKuriniai(${programId})"] i`);

            kuriniaiRows.forEach(row => {
                if (row.style.display === "none" || row.style.display === "") {
                    row.style.display = "table-row";
                    btn.innerHTML = "expand_less"; // Collapse icon
                } else {
                    row.style.display = "none";
                    btn.innerHTML = "expand_more"; // Expand icon
                }
            });
        }

        function addPrograma() {
            let table = document.getElementById("table-body");
            let rowCount = document.querySelectorAll("tbody tr:not(.kuriniai-row)").length + 1;

            let pavadinimas = document.getElementById("pavadinimas").value;
            let tipas = document.getElementById("tipas").value;
            let selectedKuriniai = [...document.querySelectorAll(".kuriniai-selection input:checked")].map(checkbox => checkbox.value);

            if (pavadinimas.trim() === "" || selectedKuriniai.length === 0) {
                alert("Prašome užpildyti visus laukelius!");
                return;
            }

            let programRow = `<tr>
                                <td class="text-center">${rowCount}</td>
                                <td>${pavadinimas}</td>
                                <td>${tipas}</td>
                                <td class="td-actions text-right">
                                    <button type="button" class="btn btn-info" onclick="toggleKuriniai(${rowCount})">
                                        <i class="material-icons">expand_more</i>
                                    </button>
                                    <button type="button" class="btn btn-success">
                                        <i class="material-icons">edit</i>
                                    </button>
                                    <button type="button" class="btn btn-danger" onclick="deleteProgram(this, ${rowCount})">
                                        <i class="material-icons">close</i>
                                    </button>
                                </td>
                              </tr>`;

            table.innerHTML += programRow;

            selectedKuriniai.forEach((kurinys, index) => {
                let [name, type] = kurinys.split("|");
                table.innerHTML += `<tr class="kuriniai-row kuriniai-${rowCount}">
                                        <td class="kuriniai-number">${index + 1}.</td>
                                        <td>${name}</td>
                                        <td>${type}</td>
                                        <td></td>
                                    </tr>`;
            });
        }
    </script>
{% endblock javascripts %}

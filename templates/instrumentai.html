{% extends "layouts/base.html" %}

{% block title %} Instrumentai {% endblock %}

{% block stylesheets %}
    <style>
        .form-control {
            margin-bottom: 10px;
        }

        .instrument-photo {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
        }
    </style>
{% endblock stylesheets %}

{% block content %}

    <div class="row">
        <!-- Instrumentai Table -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header card-header-info">
                    <h4 class="card-title">Instrumentų sąrašas</h4>
                </div>
                <div class="card-body">
                    <table class="table" id="instrumentai-table">
                        <thead>
                        <tr>
                            <th class="text-center">ID</th>
                            <th>Pavadinimas</th>
                            <th>Nuotrauka</th>
                            <th class="text-right">Actions</th>
                        </tr>
                        </thead>
                        <tbody id="table-body">
                        <!-- Example Instrumentai Rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Form to Add a New Instrumentas -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header card-header-danger">
                    <h4 class="card-title">Pridėti naują instrumentą</h4>
                    <p class="category">Įveskite informaciją apie instrumentą</p>
                </div>
                <div class="card-body">
                    <form id="add-form">
                        <div class="form-group">
                            <label>Pavadinimas</label>
                            <input type="text" id="pavadinimas" class="form-control" required
                                   placeholder="Instrumento pavadinimas">
                        </div>

                        <div class="form-group">
                            <label>Nuotraukos URL</label>
                            <input type="url" id="photo-url" class="form-control" required
                                   placeholder="Įveskite nuotraukos URL">
                        </div>

                        <button type="button" class="btn btn-danger btn-lg" onclick="addInstrumentas()">Pridėti
                            instrumentą
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <!-- Image Preview Modal (Hidden by Default) -->
    <div id="image-modal" class="modal"
         style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); justify-content: center; align-items: center;">
    <span onclick="closeModal()"
          style="position: absolute; top: 20px; right: 30px; color: white; font-size: 30px; cursor: pointer;">&times;</span>
        <img id="modal-image" style="max-width: 80%; max-height: 80%; border-radius: 10px;">
    </div>




{% endblock content %}

{% block javascripts %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            generateExampleInstrumentai();
        });

        function generateExampleInstrumentai() {
            let table = document.getElementById("table-body");

            let exampleInstrumentai = [
                {
                    id: 1,
                    pavadinimas: "Kanklės",
                    photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/24/Kankles.jpg/640px-Kankles.jpg"
                },
                {
                    id: 2,
                    pavadinimas: "Birbynė",
                    photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Birbyne_front_back.jpg/640px-Birbyne_front_back.jpg"
                },
                {
                    id: 3,
                    pavadinimas: "Skudučiai",
                    photo: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Stamps_of_Lithuania%2C_2012-04.jpg/640px-Stamps_of_Lithuania%2C_2012-04.jpg"
                }
            ];

            exampleInstrumentai.forEach(instrumentas => {
                let row = `<tr>
            <td class="text-center">${instrumentas.id}</td>
            <td>${instrumentas.pavadinimas}</td>
            <td>
                <img src="${instrumentas.photo}" class="instrument-photo" onclick="openImage('${instrumentas.photo}')">
            </td>
            <td class="td-actions text-right">
                <button type="button" class="btn btn-success">
                    <i class="material-icons">edit</i>
                </button>
                <button type="button" class="btn btn-danger" onclick="deleteInstrumentas(this)">
                    <i class="material-icons">close</i>
                </button>
            </td>
        </tr>`;

                table.innerHTML += row;
            });
        }

        function addInstrumentas() {
            let table = document.getElementById("table-body");
            let rowCount = document.querySelectorAll("#instrumentai-table tbody tr").length + 1;

            let pavadinimas = document.getElementById("pavadinimas").value;
            let photoUrl = document.getElementById("photo-url").value;

            if (pavadinimas.trim() === "" || photoUrl.trim() === "") {
                alert("Prašome užpildyti visus laukelius!");
                return;
            }

            let row = `<tr>
        <td class="text-center">${rowCount}</td>
        <td>${pavadinimas}</td>
        <td>
            <img src="${photoUrl}" class="instrument-photo" onclick="openImage('${photoUrl}')">
        </td>
        <td class="td-actions text-right">
            <button type="button" class="btn btn-success">
                <i class="material-icons">edit</i>
            </button>
            <button type="button" class="btn btn-danger" onclick="deleteInstrumentas(this)">
                <i class="material-icons">close</i>
            </button>
        </td>
    </tr>`;

            table.innerHTML += row;

            // Clear form inputs
            document.getElementById("pavadinimas").value = "";
            document.getElementById("photo-url").value = "";
        }


        function deleteInstrumentas(btn) {
            let row = btn.closest("tr");
            row.remove();
        }

        function openImage(url) {
            let modal = document.getElementById("image-modal");
            let modalImage = document.getElementById("modal-image");

            modalImage.src = url;
            modal.style.display = "flex";

            // Attach event listeners only if not already attached
            setTimeout(() => {
                document.addEventListener("click", closeModalOnClickOutside);
                document.addEventListener("keydown", closeModalOnKeyPress);
            }, 100);
        }

        function openImage(url) {
            let modal = document.getElementById("image-modal");
            let modalImage = document.getElementById("modal-image");

            modalImage.src = url;
            modal.style.display = "flex";

            // Attach event listeners only if not already attached
            setTimeout(() => {
                document.addEventListener("click", closeModalOnClickOutside);
                document.addEventListener("keydown", closeModalOnKeyPress);
            }, 100);
        }

        function closeModal() {
            let modal = document.getElementById("image-modal");
            modal.style.display = "none";

            // Remove event listeners after closing
            document.removeEventListener("click", closeModalOnClickOutside);
            document.removeEventListener("keydown", closeModalOnKeyPress);
        }

        function closeModalOnClickOutside(event) {
            let modal = document.getElementById("image-modal");
            let modalImage = document.getElementById("modal-image");

            // Close only if clicked outside the image
            if (event.target === modal) {
                closeModal();
            }
        }

        function closeModalOnKeyPress(event) {
            closeModal(); // Closes modal on any keypress
        }


    </script>
{% endblock javascripts %}
